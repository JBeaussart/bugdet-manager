<div class="container">
  <div>
    <h3><%= @account.name %> <span class='h6'>(<%= link_to 'Editer le compte', edit_account_path %> - <%= link_to 'Supprimer le compte', account_path(@account), method: 'delete' %>)</span></h3>
    <p><%= @account.bank %></p>
  </div>

  <p><%= link_to 'Ajouter une transaction', new_account_bank_transaction_path(@account), class:'btn btn-primary' %></p>
  <%# Revenu annuel + moyenne par mois%>
  <%# Depense annuel + moyenne par mois %>

  <div class="d-flex justify-content-between">
    <div class="amount_tags">
    <h3>Total annuel par catégories</h3>
      <% @account.bank_transactions.map(&:tag).uniq.each do |tag| %>
        <h5>
          <%= tag %>: <%= @account.bank_transactions.where(tag: tag).sum(&:amount) %>€
          <span class="h6 text-muted">≈<%= (@account.bank_transactions.where(tag: tag).sum(&:amount) / @account.bank_transactions.where(tag: tag).count).round(2) %>€ / mois</span>
        </h5>
      <% end %>
      <div>
        <% revenu = 0 %>
        <% depense = 0 %>
        <% @account.bank_transactions.each do |el| %>
          <% if el.amount.positive? %>
            <% revenu += el.amount %>
          <% else %>
            <% depense += el.amount %>
          <% end %>
        <% end %>
        <hr>
        <h5>Revenu annuel: <%= revenu %>€</h5>
        <h5>Dépense annuelle: <%= depense %>€</h5>
        <hr>
        <h5>Epargne: <%= revenu + depense %>€</h5>
      </div>
    </div>



    <div class="amount_month_tags">
      <% months = ['Janvier', 'Fevrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'aout', 'septembre', 'octobre', 'novembre', 'décembre'] %>
      <% tags = ['Revenu', 'Logement', 'Vacances', 'Voiture', 'Abonnement', 'Animaux', 'Santé', 'Loisir', 'CB', 'Autre'] %>
      <% months.each_with_index do |month, id| %>
        <% if @account.bank_transactions.where('extract(month from date) = ?', id + 1).sum(&:amount) != 0%>
          <h3>Epargne du mois de <%= month %>: <%= @account.bank_transactions.where('extract(month from date) = ?', id + 1).sum(&:amount) %>€</h3>
          <% tags.each do |tag| %>
            <div>
              <p><%= tag %>: <%= @account.bank_transactions.where('extract(month from date) = ? and tag = ?', id + 1, tag).sum(&:amount) %>€</p>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>


